---
title: 为什么要写注释
tags:
  - 职业修养
categories:
  - 读书笔记
  - 编写可读代码的艺术
date: 2020-01-04 12:09:18
---

# 第五章：该写什么样的注释

代码的注释是帮助别人理解代码最直观的方式，但是注释的目的不只是为了解释代码做了什么，而是尽量让读者对代码理解的程度和作者一样多。

当你在写代码的时候，脑子中想的东西绝对会比所写的代码展现出来的更多。但这些东西在其他人看到你的代码时就不再存在，甚至时隔半年，再看自己写的代码，也会忘记这些信息。注释最大的目的就是帮助读者知道这些“丢失”的信息。

## 有些注释是不需要的

阅读注释会占据阅读真实代码的时间，如果注释所表现的信息，比不上注释所占时间和空间的代价，这个注释就是多余的。

比如下面代码的注释就是毫无意义的：

```javascript
/**
 * @async
 * @function handleViewHis
 * @param {object} params - 请求参数
 * @returns {array} fetch Promise
 */
export async function handleViewHis(params) {
  return xxx;
}
```

这段注释提供的信息从函数中就能直接看出来，还占据了大部分的空间，也没有帮助读者更**快速**的理解代码。所以不要为那些可以从代码本身快速推断出来的信息写注释。

当然，这个**快速**是区分注释有没有用的重要标志，例如下面这段代码：

```javascript
// 将数字转化为千分位
const value = `${value}`.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
```

从技术上来说，这段没有表达新的信息，只是告诉读者这段代码的功能。如果你读了，也能理解这个代码的意思，但是加上这个注释，你就没必要花费时间去分析这个正则表达式了。这段注释帮助了读者快速理解代码，不是非必要的注释。

### 不要为了注释而注释

有些人会对没有注释的函数有负罪感，强行写注释，其实只是把函数名和参数重写了一下。这是很`low`的行为，如果务必要写注释，可以从该函数重要的细节入手，例如给出函数在不同条件下的不同表现等。

### 不要给不好的名字加注释——应该把名字起好

如果因为函数名字不清楚而写一个注释来说明，这是最不可取的，在前几章中，讲到了如何起名字，这种情况下需要将注释中的内容经过修改加到名字里面去。从而让函数有更好的自我说明性。

> 一个好的名字比一段好的注释更加重要，因为在任何用到这个函数的地方都能看得到它。

不需要使用**拐杖注释**（为了修饰可读性差的代码的注释）。

> 好代码 > 坏代码 + 好注释

## 记录你的思想

好的注释可以通过“记录自己的想法”得到，就是在写代码的时候有的很重要的想法。

### 加入导演评论

导演评论就是电影制作者在电影中给出自己的见解并通过讲故事来帮助理解这部电影是怎么制作的。

类似的可以在代码中加入注释来记录对代码有价值的见解。

例如：

**这个注释可以帮助后来者避免不必要的优化而浪费时间**

```
//出乎意料的是，对于这些数据用二叉树比用哈希表快 40%
//哈希运算的代价比左/右比较大得多
```

**这个注释可以避免读者以为功能有`bug`进行调试，从而浪费时间**

```
//作为整体可能会丢掉几个词。这没有问题。要 100%解决太难了
```

**这个注释解释了代码为什么会不那么整洁，鼓励后来者对其进行优化（虽然可能没人优化）**

```
//这个类正在变得越来越乱
//也许我们应该建立一个'ResourceNode'子类来帮助整理
```

### 为代码的瑕疵写注释

代码是不断进化的，而代码中的瑕疵也不可避免，可以将瑕疵记录下来，方便他人有必要的时候进行改进，可以使用下面这些标记来进行标识。

![](00071.jpg)

> 重要的是你应该可以随时把代码将来应该如何改动的想法用注释记录下来。这种注释给读者带来对代码质量和当前状态的宝贵见解，甚至可能会给他们指出如何改进代码的方向。

### 给常量加注释

这个很好理解，常量在定义的时候必然有它的意义，这对于代码的理解很重要。使用该常量的人必须知道该常量的意义，取值范围怎么判定的等必要的信息。

注释常量的方法就是写下你定义这个常量时内心的想法就好。

## 站在读者的角度

把自己摆在读者的角度，假设自己对代码一无所知，想想自己想看到什么，对写出好的注释十分有用。

### 意料之中的提问

在阅读未接触过的代码时，必然会有“这里为什么这样写”，“这里的意思是什么”的疑问，一定要在这些地方加上注释。

### 公布可能的陷阱

在给一个函数或者类写文档的时候，一定要想到各种边界处理，以及会不会被误用，要未雨绸缪。预测到可能会发生的问题，并在注释中标记好，以免被误用。

例如某些可能会误用的函数：

![](00097.jpg)

该函数是调用外部服务器进行邮件发送，所以时间会很久，需要加上注释避免被误用。

![](00087.jpg)

该方法当在特殊情况下运行时间要暴增，需要写上注释说明它的局限性。

### 全局观注释

> 全局观：类之间如何交互，数据如何在整个系统中流动，以及入口点在哪里。设计系统的人经常忘记给这些东西加注释。

主要是对某个模块整体进行注释，这样可以帮助新成员更好的理解系统层级的设计和对应模块的作用。

### 总结性注释

> 总结性注释同时也是对于函数所做事情的总结，因此读者可以在深入了解细节之前就能得到该函数的主旨。

总结性注释可以做任何能帮助读者更容易理解代码的事。这可能也会包含对于“做什么”、“怎么做”、“为什么”的注释（或者同时注释这三个方面）。

## 克服写注释的心理障碍

当你认为写注释是一件很痛苦的事情，那就去做吧，经常写就能熟能生巧，可以分为下面三步。

1. 不管你心里想什么，先把它写下来。
2. 读一下这段注释，看看有没有什么地方可以改进。
3. 不断改进。

## 总结

注释的目的是帮助读者了解作者在写代码时已经知道的那些事情。本章主要是对如何写注释进行了说明。

什么地方不需要注释：

- 能从代码本身中迅速地推断的事实。
- 用来粉饰烂代码（例如蹩脚的函数名）的“拐杖式注释”——应该把代码改好。

你应该记录下来的想法包括：

- 对于为什么代码写成这样而不是那样的内在理由（“指导性批注”）。

- 代码中的缺陷，使用像 TODO：或者 XXX：这样的标记。

- 常量背后的故事，为什么是这个值。

站在读者的立场上思考：

- 预料到代码中哪些部分会让读者说：“啊？”并且给它们加上注释。

- 为普通读者意料之外的行为加上注释。

- 在文件/类的级别上使用“全局观”注释来解释所有的部分是如何一起工作的。

- 用注释来总结代码块，使读者不致迷失在细节中。
