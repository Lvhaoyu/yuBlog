---
title: 编写可读代码的艺术（五）
tags:
  - 职业修养
categories:
  - 读书笔记
  - 编写可读代码的艺术
date: 2020-01-09 10:10:24
---


# 第六章：写出言简意赅的注释

本章主要是承接上章，上一章讲解了在什么地方写注释，这一章主要讲解注释应该怎么写。既然决定写注释，一定要保证注释的精确性（明确性和细致性），而且为了保证注释的紧凑性，**注释一定要有很高的信息/空间率**。

## 让注释保持紧凑

这个很好理解，例如下面的注释：

![](00335.jpg)

这个简单的注释写了三行，完全可以简化成一行：

![](00338.jpg)

注释的冗余程度很好判断，写注释的时候要想到代码是给同事看的，大家都是懂技术的人。注释可以表达清楚自己的想法就好，不必太过详细显得啰嗦。

## 避免使用不明确的代词

例如`JavaScript`中的`this`，有些情况下为了保存当前`this`的引用（`this`就是函数运行时所在的环境对象，它难就难在判断怎么判断环境对象）。而在`JavaScript`代码中经常出现的`var that = this`的意思就是由于`this`是会变化的，需要将某一时刻的`this`保存从而拿到对应环境的值。

例如这段代码：

```JavaScript
$(‘#conten').click(function(){
    // svae this in that
    var that = this;
    $(‘.conten').each(function(){
    });
});
```

大家都知道`this`是函数运行时所在的环境，但是这个环境是什么注释没有指明，需要向下或向上寻找函数运行才能发现。这就和注释的初衷不符了。

应该改为：

```javascript
// save this（is the clicked content） in that
```

与之类似的还有`it`等代词，当使用这些意义不明确的注释时，一定要确保在注释中将其指代的意思阐明。

## 润色粗糙的句子

大多情况下，让注释更精确的过程就是让注释更紧凑的过程。

例如下面网页爬虫的注释：

![](00347.jpg)

乍一看没啥问题，但是和下面的对比一下：

![](00199.jpg)

后者短小精悍，虽然单词少了，但是表达的意思更加明确。

## 精确地描述函数的行为

如果有一个函数是统计一个文件中的行数，就会产生很多问题。大家都知道不同操作系统换行(hang)行(xing)为是不一样的。

例如 UNIX 使用`/n`，MAC 使用`/r`，Windows 使用`/r/n`。还有一些特殊的情况，例如空行算不算一行？单词中掺杂了对应的换行回车符号怎么处理等。

以上都是需要注释中表明的部分，下面的注释就是一个很好的例子：

```JavaScript
// Count how many new line bytes ('/n') are in the file.
```

这个注释中表明了以换行符(`/n`)为准，且`/r`会被忽略。这就涵盖了读者几乎想知道的全部信息。

## 用输入输出的例子来说明特别的情况

这个在刷题的时候深有体会，当题干不是很清晰的时候，直接去看测试用例，再加上对题干的描述就会很清晰了。

类似，与功能对应的测试用例就可以成为一个好的注释的来源，但是要注意几点：

- 测试用例不要太简单，要兼顾读者可能考虑到的各种情况
- 一定要将边界问题在测试用例中体现出来
- 注意测试用例的选取一定要没有规律，显示出普遍性（例如排序与否）
- 测试用例不要包含返回值

要兼顾这些情况，才可以使用测试用例来写出好的注释。

## 表明代码的意图

注释的作用就是告诉读者你写这段代码是怎么想的，所以注释不能局限于代码字面上的意思，要从一些高的层次表达出更多的信息。

下面这个例子就是与该思想背道而驰的：

![](00268.jpg)

这段注释仅仅说明了接下来循环的意思，有点模棱两可。

![](00373.jpg)

很明显这段注释表示了更多的信息，第一个注释只是在代码层面阐述代码的功能，第二个则是从实际完成的需求出发，描述对应的实现思路。

而且如果这段代码有`bug`，第二个注释能够让读者更容易发现`bug`，第一个注释只是描述了一行代码的意思，第二个注释中包含的更多信息则可以扮演**冗余检查**的角色。

## ”具备函数函数“的注释

在有些语言中，函数调用时不允许根据对应的参数名称来给参数赋值，`Python`和`JavaScript`是可以的，就像这样：

```JavaScript
Connect(a=5,b=6)
```

有些语言只能这样调用：

```Java
Connect(5, 6)
```

这可能会让人很迷惑，不知道这两个参数代表着什么。虽然语言不支持，但是可以使用注释达到同样的效果：

```Java
Connect(/*a=*/ 5, /*b=*/ 6);
```

对于布尔值来说，对应的参数注释写再前边尤为重要，因为表示状态的值写在注释前会给人一种这个状态表示的意义不清楚的感觉：

![](00387.jpg)

这种情况下就无法一眼看出`false`表示的是`use_xxx`，还是`use_xxx`的值是`fasle`。

当然在函数中写参数注释的情况不多见，但是这种方法可以帮助读者更好的根据参数理解代码的功能。

## 采用信息含量高的词

大体意思就是当你的阅历和技术底蕴到了一定层次之后，有些普遍的问题和解决方案会有专门的词或短语来描述这种模式/定式。使用这些词就可以让注释更加紧凑。

当你发现一段注释太长，可以一个典型的编程场景来描述它。

## 总结

本章是关于如何把更多的信息装入更小的空间里。

- 当像"it"和"this"这样的代词可能指代多个事物时，避免使用它们。

- 尽量精确地描述函数的行为。

- 在注释中用精心挑选的输入/输出例子进行说明。

- 声明代码的高层次意图，而非明显的细节。

- 用嵌入的注释（如`Function（/*arg=*/……）`）来解释难以理解的函数参数。

- 用含义丰富的词来使注释简洁。








